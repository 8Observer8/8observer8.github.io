window.onload=init;function init(){var isDragging=false;var previousMousePosition={x:0,y:0};var threeJSContainer=document.getElementById("threeJSContainer");var FOV=45,ASPECT=threeJSContainer.clientWidth/threeJSContainer.clientHeight;var NEAR=.1,FAR=1e3;var camera=new THREE.PerspectiveCamera(FOV,ASPECT,NEAR,FAR);var scene=new THREE.Scene;var renderer=new THREE.WebGLRenderer;renderer.setClearColor(new THREE.Color(15658734));renderer.setSize(threeJSContainer.clientWidth,threeJSContainer.clientHeight);var cubeGeometry=new THREE.BoxGeometry(1,1,1);var cubeMaterial=new THREE.MeshLambertMaterial({color:65280});var cube=new THREE.Mesh(cubeGeometry,cubeMaterial);scene.add(cube);camera.position.z=-3;camera.lookAt(scene.position);var ambientLight=new THREE.AmbientLight(6579300);scene.add(ambientLight);var spotLight=new THREE.SpotLight(16777215);spotLight.position.set(-40,60,-10);scene.add(spotLight);document.getElementById("threeJSContainer").appendChild(renderer.domElement);document.addEventListener("resize",onWindowResize,false);var axesHelper=new THREE.AxesHelper(5,5,5);scene.add(axesHelper);var insetContainer=document.getElementById("insetContainer");var rendererInset=new THREE.WebGLRenderer;rendererInset.setClearColor(15790320,1);rendererInset.setSize(insetContainer.clientWidth,insetContainer.clientHeight);insetContainer.appendChild(rendererInset.domElement);insetContainer.onmousedown=onMouseDown;insetContainer.onmousemove=onMouseMove;insetContainer.onmouseout=onMouseOut;var sceneInset=new THREE.Scene;var FRUSTUM_SIZE_INSET=3;var ASPECT_INSET=insetContainer.clientWidth/insetContainer.clientHeight;var LEFT_INSET=FRUSTUM_SIZE_INSET*ASPECT_INSET/-2;var RIGHT_INSET=FRUSTUM_SIZE_INSET*ASPECT_INSET/2;var TOP_INSET=FRUSTUM_SIZE_INSET/2;var BOTTOM_INSET=FRUSTUM_SIZE_INSET/-2;var NEAR_INSET=.1,FAR_INSET=10;cameraInset=new THREE.OrthographicCamera(LEFT_INSET,RIGHT_INSET,TOP_INSET,BOTTOM_INSET,NEAR_INSET,FAR_INSET);cameraInset.position.z=-5;cameraInset.lookAt(sceneInset.position);var loader=new THREE.JSONLoader;var viewSelector;loader.load("./models/ViewSelector.json",function(geometry,materials){for(var i=0;i<materials.length;i++){materials[i]=new THREE.MeshBasicMaterial({map:(new THREE.TextureLoader).load("./models/ViewSelector.png")})}viewSelector=new THREE.Mesh(geometry,materials);sceneInset.add(viewSelector)});threeJSContainer.onmousedown=function(event){isDragging=true};threeJSContainer.onmousemove=function(e){if(viewSelector===undefined){return}var deltaMove={x:e.offsetX-previousMousePosition.x,y:e.offsetY-previousMousePosition.y};if(isDragging){var deltaRotationQuaternion=(new THREE.Quaternion).setFromEuler(new THREE.Euler(THREE.Math.degToRad(-deltaMove.y*1),THREE.Math.degToRad(deltaMove.x*1),0,"XYZ"));cube.quaternion.multiplyQuaternions(deltaRotationQuaternion,cube.quaternion);viewSelector.quaternion.multiplyQuaternions(deltaRotationQuaternion,viewSelector.quaternion)}previousMousePosition={x:e.offsetX,y:e.offsetY}};threeJSContainer.onmouseup=function(event){isDragging=false};var tween;render();function render(){if(tween!==undefined){TWEEN.update()}renderer.render(scene,camera);rendererInset.render(sceneInset,cameraInset);requestAnimationFrame(render)}function onMouseDown(event){intersects=GetIntersectObjects(event);if(intersects.length>0){var faceName=GetFaceNameByIndex(intersects[0].faceIndex);if(faceName!==undefined){var rx=viewSelector.rotation.x;var ry=viewSelector.rotation.y;var rz=viewSelector.rotation.z;var rot_prev=new THREE.Vector3(rx,ry,rz);var rot={rx:rx,ry:ry,rz:rz};var timeInterval=300;var ry_target;if(faceName==="back"){ry_target=Math.PI;if(rot.ry<0){ry_target=-Math.PI}tween=new TWEEN.Tween(rot).to({rx:0,ry:ry_target,rz:0},timeInterval).onUpdate(function(){viewSelector.rotation.set(rot.rx,rot.ry,rot.rz);cube.rotation.set(rot.rx,rot.ry,rot.rz)}).onComplete(function(){showAngle(rot_prev,viewSelector)}).start()}else if(faceName=="top"){tween=new TWEEN.Tween(rot).to({rx:-Math.PI/2,ry:0,rz:0},timeInterval).onUpdate(function(){viewSelector.rotation.set(rot.rx,rot.ry,rot.rz);cube.rotation.set(rot.rx,rot.ry,rot.rz)}).onComplete(function(){showAngle(rot_prev,viewSelector)}).start()}else if(faceName=="left"){ry_target=Math.PI/2;if(rot.ry<0){ry_target=-3*Math.PI/2}tween=new TWEEN.Tween(rot).to({rx:0,ry:ry_target,rz:0},timeInterval).onUpdate(function(){viewSelector.rotation.set(rot.rx,rot.ry,rot.rz);cube.rotation.set(rot.rx,rot.ry,rot.rz)}).onComplete(function(){showAngle(rot_prev,viewSelector)}).start()}else if(faceName=="right"){ry_target=-Math.PI/2;if(rot.ry>0){ry_target=3*Math.PI/2}tween=new TWEEN.Tween(rot).to({rx:0,ry:ry_target,rz:0},timeInterval).onUpdate(function(){viewSelector.rotation.set(rot.rx,rot.ry,rot.rz);cube.rotation.set(rot.rx,rot.ry,rot.rz)}).onComplete(function(){showAngle(rot_prev,viewSelector)}).start()}else if(faceName=="bottom"){tween=new TWEEN.Tween(rot).to({rx:Math.PI/2,ry:0,rz:0},timeInterval).onUpdate(function(){viewSelector.rotation.set(rot.rx,rot.ry,rot.rz);cube.rotation.set(rot.rx,rot.ry,rot.rz)}).onComplete(function(){showAngle(rot_prev,viewSelector)}).start()}else if(faceName=="front"){ry_target=0;if(7*Math.PI/4<=rot.ry){ry_target=2*Math.PI}else if(rot.ry<=-7*Math.PI/4){ry_target=-2*Math.PI}else if(rot.ry>7*Math.PI/4){ry_target=2*Math.PI}tween=new TWEEN.Tween(rot).to({rx:0,ry:ry_target,rz:0},timeInterval).onUpdate(function(){viewSelector.rotation.set(rot.rx,rot.ry,rot.rz);cube.rotation.set(rot.rx,rot.ry,rot.rz)}).onComplete(function(){showAngle(rot_prev,viewSelector)}).start()}else if(faceName=="corner-top-left-front"){ry_target=Math.PI/4;if(7*Math.PI/4<=rot.ry&&rot.ry<2*Math.PI){rot.ry=-Math.PI/4}else if(2*Math.PI<=rot.ry){rot.ry=0}if(-Math.PI/4<=rot.ry){ry_target=Math.PI/4}else if(rot.ry<0){ry_target=-7*Math.PI/4}tween=new TWEEN.Tween(rot).to({rx:-Math.PI/4,ry:ry_target,rz:0},timeInterval).onUpdate(function(){viewSelector.rotation.set(rot.rx,rot.ry,rot.rz);cube.rotation.set(rot.rx,rot.ry,rot.rz)}).onComplete(function(){showAngle(rot_prev,viewSelector)}).start()}else if(faceName=="corner-top-back-left"){ry_target=3*Math.PI/4;if(rot.ry<0){ry_target=-5*Math.PI/4}tween=new TWEEN.Tween(rot).to({rx:-Math.PI/4,ry:ry_target,rz:0},timeInterval).onUpdate(function(){viewSelector.rotation.set(rot.rx,rot.ry,rot.rz);cube.rotation.set(rot.rx,rot.ry,rot.rz)}).onComplete(function(){showAngle(rot_prev,viewSelector)}).start()}else if(faceName=="corner-top-right-back"){ry_target=-3*Math.PI/4;if(rot.ry>0){ry_target=5*Math.PI/4}tween=new TWEEN.Tween(rot).to({rx:-Math.PI/4,ry:ry_target,rz:0},timeInterval).onUpdate(function(){viewSelector.rotation.set(rot.rx,rot.ry,rot.rz);cube.rotation.set(rot.rx,rot.ry,rot.rz)}).onComplete(function(){showAngle(rot_prev,viewSelector)}).start()}else if(faceName=="corner-top-front-right"){ry_target=-Math.PI/4;if(5*Math.PI/4<=rot.ry){ry_target=7*Math.PI/4}else if(-2*Math.PI<rot.ry&&rot.ry<=-7*Math.PI/4){rot.ry=Math.PI/4}else if(rot.ry<=-2*Math.PI){rot.ry=0}tween=new TWEEN.Tween(rot).to({rx:-Math.PI/4,ry:ry_target,rz:0},timeInterval).onUpdate(function(){viewSelector.rotation.set(rot.rx,rot.ry,rot.rz);cube.rotation.set(rot.rx,rot.ry,rot.rz)}).onComplete(function(){showAngle(rot_prev,viewSelector)}).start()}else if(faceName=="corner-bottom-front-left"){ry_target=Math.PI/4;if(7*Math.PI/4<=rot.ry&&rot.ry<2*Math.PI){rot.ry=-Math.PI/4}else if(2*Math.PI<=rot.ry){rot.ry=0}if(-Math.PI/4<=rot.ry){ry_target=Math.PI/4}else if(rot.ry<0){ry_target=-7*Math.PI/4}tween=new TWEEN.Tween(rot).to({rx:Math.PI/4,ry:ry_target,rz:0},timeInterval).onUpdate(function(){viewSelector.rotation.set(rot.rx,rot.ry,rot.rz);cube.rotation.set(rot.rx,rot.ry,rot.rz)}).onComplete(function(){showAngle(rot_prev,viewSelector)}).start()}else if(faceName=="corner-bottom-left-back"){ry_target=3*Math.PI/4;if(rot.ry<0){ry_target=-5*Math.PI/4}tween=new TWEEN.Tween(rot).to({rx:Math.PI/4,ry:ry_target,rz:0},timeInterval).onUpdate(function(){viewSelector.rotation.set(rot.rx,rot.ry,rot.rz);cube.rotation.set(rot.rx,rot.ry,rot.rz)}).onComplete(function(){showAngle(rot_prev,viewSelector)}).start()}else if(faceName=="corner-bottom-back-right"){ry_target=-3*Math.PI/4;if(rot.ry>0){ry_target=5*Math.PI/4}tween=new TWEEN.Tween(rot).to({rx:Math.PI/4,ry:ry_target,rz:0},timeInterval).onUpdate(function(){viewSelector.rotation.set(rot.rx,rot.ry,rot.rz);cube.rotation.set(rot.rx,rot.ry,rot.rz)}).onComplete(function(){showAngle(rot_prev,viewSelector)}).start()}else if(faceName=="corner-bottom-right-front"){ry_target=-Math.PI/4;if(5*Math.PI/4<=rot.ry){ry_target=7*Math.PI/4}else if(-2*Math.PI<rot.ry&&rot.ry<=-7*Math.PI/4){rot.ry=Math.PI/4}else if(rot.ry<=-2*Math.PI){rot.ry=0}tween=new TWEEN.Tween(rot).to({rx:Math.PI/4,ry:ry_target,rz:0},timeInterval).onUpdate(function(){viewSelector.rotation.set(rot.rx,rot.ry,rot.rz);cube.rotation.set(rot.rx,rot.ry,rot.rz)}).onComplete(function(){showAngle(rot_prev,viewSelector)}).start()}}}}function showAngle(rot,viewSelector){}function onMouseOut(event){resetSelectionsFaces()}function onMouseMove(event){intersects=GetIntersectObjects(event);if(intersects===undefined){return undefined}if(intersects.length>0){var faceName=GetFaceNameByIndex(intersects[0].faceIndex);if(faceName!==undefined){resetSelectionsFaces();var selectionColor=255;if(faceName==="back"){intersects[0].object.material[1].color.set(selectionColor)}else if(faceName=="top"){intersects[0].object.material[2].color.set(selectionColor)}else if(faceName=="left"){intersects[0].object.material[3].color.set(selectionColor)}else if(faceName=="right"){intersects[0].object.material[4].color.set(selectionColor)}else if(faceName=="bottom"){intersects[0].object.material[5].color.set(selectionColor)}else if(faceName=="front"){intersects[0].object.material[6].color.set(selectionColor)}else if(faceName=="corner-top-left-front"){intersects[0].object.material[7].color.set(selectionColor)}else if(faceName=="corner-top-back-left"){intersects[0].object.material[8].color.set(selectionColor)}else if(faceName=="corner-top-right-back"){intersects[0].object.material[9].color.set(selectionColor)}else if(faceName=="corner-top-front-right"){intersects[0].object.material[10].color.set(selectionColor)}else if(faceName=="corner-bottom-front-left"){intersects[0].object.material[11].color.set(selectionColor)}else if(faceName=="corner-bottom-left-back"){intersects[0].object.material[12].color.set(selectionColor)}else if(faceName=="corner-bottom-back-right"){intersects[0].object.material[13].color.set(selectionColor)}else if(faceName=="corner-bottom-right-front"){intersects[0].object.material[14].color.set(selectionColor)}else{resetSelectionsFaces()}}else{resetSelectionsFaces()}}else{resetSelectionsFaces()}}function resetSelectionsFaces(){for(var i=1;i<viewSelector.material.length;i++){viewSelector.material[i].color.set(16777215)}}function GetIntersectObjects(mouseEvent){if(viewSelector===undefined){return undefined}var x=event.clientX;var y=event.clientY;var rect=event.target.getBoundingClientRect();x=(x-rect.left)/insetContainer.clientWidth*2-1;y=-(y-rect.top)/insetContainer.clientHeight*2+1;var mouse=new THREE.Vector2(x,y);var raycaster=new THREE.Raycaster;raycaster.setFromCamera(mouse,cameraInset);var intersects=raycaster.intersectObjects([viewSelector]);return intersects}function GetFaceNameByIndex(faceIndex){var faceName;if(faceIndex===6||faceIndex===7){faceName="top"}else if(faceIndex===4||faceIndex===5){faceName="right"}else if(faceIndex===8||faceIndex===9){faceName="back"}else if(faceIndex===42||faceIndex===43){faceName="left"}else if(faceIndex===2||faceIndex===3){faceName="bottom"}else if(faceIndex===0||faceIndex===1){faceName="front"}else if(faceIndex===17){faceName="corner-top-front-right"}else if(faceIndex===14){faceName="corner-top-left-front"}else if(faceIndex===15){faceName="corner-top-back-left"}else if(faceIndex===16){faceName="corner-top-right-back"}else if(faceIndex===13){faceName="corner-bottom-right-front"}else if(faceIndex===10){faceName="corner-bottom-front-left"}else if(faceIndex===11){faceName="corner-bottom-left-back"}else if(faceIndex===12){faceName="corner-bottom-back-right"}return faceName}function onWindowResize(){camera.aspect=threeJSContainer.clientWidth/threeJSContainer.clientHeight;camera.updateProjectionMatrix();renderer.setSize(threeJSContainer.clientWidth,threeJSContainer.clientHeight)}}