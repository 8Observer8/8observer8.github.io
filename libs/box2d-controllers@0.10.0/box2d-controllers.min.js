/**
 * Bundled by jsDelivr using Rollup v2.79.1 and Terser v5.19.2.
 * Original file: /npm/@box2d/controllers@0.10.0/dist/index.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
import e from"/npm/@box2d/core@0.10.0/+esm";var t="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},o={};const r=e;(0,r.b2_augment)(r.b2World,{Create(e,t){const o=e(t);return o.m_controllerList=null,o.m_controllerCount=0,o}}),Object.assign(r.b2World.prototype,{AddController(e){return e.m_next=this.m_controllerList,e.m_prev=null,this.m_controllerList&&(this.m_controllerList.m_prev=e),this.m_controllerList=e,++this.m_controllerCount,e},RemoveController(e){return e.m_prev&&(e.m_prev.m_next=e.m_next),e.m_next&&(e.m_next.m_prev=e.m_prev),this.m_controllerList===e&&(this.m_controllerList=e.m_next),--this.m_controllerCount,e.m_prev=null,e.m_next=null,e}}),(0,r.b2_augment)(r.b2World.prototype,{CreateBody(e,t={}){const o=e(t);return o.m_controllerList=null,o.m_controllerCount=0,o},DestroyBody(e,t){let o=t.m_controllerList;for(;o;){const e=o;o=o.nextController,e.controller.RemoveBody(t)}e(t)},Solve(e,t){for(let e=this.m_controllerList;e;e=e.m_next)e.Step(t);e(t)}});var n={};Object.defineProperty(n,"__esModule",{value:!0}),n.b2Controller=n.b2ControllerEdge=void 0;const l=e;class s{constructor(e,t){this.prevBody=null,this.nextBody=null,this.prevController=null,this.nextController=null,this.controller=e,this.body=t}}n.b2ControllerEdge=s;n.b2Controller=class{constructor(){this.m_bodyList=null,this.m_bodyCount=0,this.m_prev=null,this.m_next=null}GetNext(){return this.m_next}GetPrev(){return this.m_prev}GetBodyList(){return this.m_bodyList}AddBody(e){const t=new s(this,e);t.nextBody=this.m_bodyList,t.prevBody=null,this.m_bodyList&&(this.m_bodyList.prevBody=t),this.m_bodyList=t,++this.m_bodyCount,t.nextController=e.m_controllerList,t.prevController=null,e.m_controllerList&&(e.m_controllerList.prevController=t),e.m_controllerList=t,++e.m_controllerCount}RemoveBody(e){(0,l.b2Assert)(this.m_bodyCount>0,"Controller is empty");let t=this.m_bodyList;for(;t&&t.body!==e;)t=t.nextBody;(0,l.b2Assert)(null!==t,"Body is not attached to the controller"),t.prevBody&&(t.prevBody.nextBody=t.nextBody),t.nextBody&&(t.nextBody.prevBody=t.prevBody),this.m_bodyList===t&&(this.m_bodyList=t.nextBody),--this.m_bodyCount,t.nextController&&(t.nextController.prevController=t.prevController),t.prevController&&(t.prevController.nextController=t.nextController),e.m_controllerList===t&&(e.m_controllerList=t.nextController),--e.m_controllerCount}Clear(){for(;this.m_bodyList;)this.RemoveBody(this.m_bodyList.body);this.m_bodyCount=0}};var i={},c={};!function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.b2SubmergedAreaForShape=t.b2SubmergedAreaByShape=void 0;const o=e,r=new o.b2Vec2,n=new o.b2MassData,l=new o.b2Vec2,s=new o.b2Vec2,i=new o.b2Vec2;t.b2SubmergedAreaByShape=[],t.b2SubmergedAreaByShape[o.b2ShapeType.e_circle]=function(e,t,r,n,l){const s=e,i=o.b2Transform.MultiplyVec2(n,s.m_p,new o.b2Vec2),c=-(o.b2Vec2.Dot(t,i)-r);if(c<-s.m_radius+o.b2_epsilon)return 0;if(c>s.m_radius)return l.Copy(i),Math.PI*s.m_radius*s.m_radius;const a=s.m_radius*s.m_radius,y=c*c,b=a*(Math.asin(c/s.m_radius)+Math.PI/2)+c*Math.sqrt(a-y),d=-2/3*(a-y)**1.5/b;return l.x=i.x+t.x*d,l.y=i.y+t.y*d,b},t.b2SubmergedAreaByShape[o.b2ShapeType.e_edge]=function(e,t,o,r,n){return n.SetZero(),0},t.b2SubmergedAreaByShape[o.b2ShapeType.e_polygon]=function(e,t,c,a,y){const b=e,d=o.b2Rot.TransposeMultiplyVec2(a.q,t,r),m=c-o.b2Vec2.Dot(t,a.p),u=[];let _=0,p=-1,h=-1,C=!1;for(let e=0;e<b.m_count;++e){u[e]=o.b2Vec2.Dot(d,b.m_vertices[e])-m;const t=u[e]<-o.b2_epsilon;e>0&&(t?C||(p=e-1,_++):C&&(h=e-1,_++)),C=t}switch(_){case 0:if(C){const e=n;return b.ComputeMass(e,1),o.b2Transform.MultiplyVec2(a,e.center,y),e.mass}return 0;case 1:-1===p?p=b.m_count-1:h=b.m_count-1}const x=(p+1)%b.m_count,v=(h+1)%b.m_count,f=(0-u[p])/(u[x]-u[p]),S=(0-u[h])/(u[v]-u[h]),L=l.Set(b.m_vertices[p].x*(1-f)+b.m_vertices[x].x*f,b.m_vertices[p].y*(1-f)+b.m_vertices[x].y*f),V=s.Set(b.m_vertices[h].x*(1-S)+b.m_vertices[v].x*S,b.m_vertices[h].y*(1-S)+b.m_vertices[v].y*S);let g=0;const w=i.SetZero();let B,A=b.m_vertices[x],G=x;for(;G!==v;){G=(G+1)%b.m_count,B=G===v?V:b.m_vertices[G];const e=.5*((A.x-L.x)*(B.y-L.y)-(A.y-L.y)*(B.x-L.x));g+=e,w.x+=e*(L.x+A.x+B.x)/3,w.y+=e*(L.y+A.y+B.y)/3,A=B}return w.Scale(1/g),o.b2Transform.MultiplyVec2(a,w,y),g},t.b2SubmergedAreaByShape[o.b2ShapeType.e_chain]=function(e,t,o,r,n){return n.SetZero(),0},t.b2SubmergedAreaForShape=function(e,o,r,n,l){const s=t.b2SubmergedAreaByShape[e.GetType()];return s?s(e,o,r,n,l):0}}(c),Object.defineProperty(i,"__esModule",{value:!0}),i.b2BuoyancyController=void 0;const a=e,y=n,b=c,d={buoyancyForce:new a.b2Vec2};class m extends y.b2Controller{constructor(){super(...arguments),this.normal=new a.b2Vec2(0,1),this.offset=0,this.density=0,this.velocity=new a.b2Vec2,this.linearDrag=0,this.angularDrag=0,this.useDensity=!1,this.useWorldGravity=!0,this.gravity=new a.b2Vec2}Step(e){if(!this.m_bodyList)return;this.useWorldGravity&&this.gravity.Copy(this.m_bodyList.body.GetWorld().GetGravity());const{buoyancyForce:t}=d;for(let e=this.m_bodyList;e;e=e.nextBody){const{body:o}=e;if(!o.IsAwake())continue;const r=new a.b2Vec2,n=new a.b2Vec2;let l=0,s=0;for(let e=o.GetFixtureList();e;e=e.GetNext()){const t=new a.b2Vec2,i=(0,b.b2SubmergedAreaForShape)(e.GetShape(),this.normal,this.offset,o.GetTransform(),t);l+=i,r.x+=i*t.x,r.y+=i*t.y;let c=0;c=this.useDensity?e.GetDensity():1,s+=i*c,n.x+=i*t.x*c,n.y+=i*t.y*c}if(r.x/=l,r.y/=l,n.x/=s,n.y/=s,l<a.b2_epsilon)continue;a.b2Vec2.Negate(this.gravity,t),t.Scale(this.density*l),o.ApplyForce(t,n);const i=o.GetLinearVelocityFromWorldPoint(r,new a.b2Vec2);i.Subtract(this.velocity),i.Scale(-this.linearDrag*l),o.ApplyForce(i,r),o.ApplyTorque(-o.GetInertia()/o.GetMass()*l*o.GetAngularVelocity()*this.angularDrag)}}}i.b2BuoyancyController=m;var u={};Object.defineProperty(u,"__esModule",{value:!0}),u.b2ConstantAccelController=void 0;const _=e,p=n,h=new _.b2Vec2;class C extends p.b2Controller{constructor(){super(...arguments),this.A=new _.b2Vec2}Step(e){_.b2Vec2.Scale(e.dt,this.A,h);for(let e=this.m_bodyList;e;e=e.nextBody){const{body:t}=e;t.IsAwake()&&t.SetLinearVelocity(_.b2Vec2.Add(t.GetLinearVelocity(),h,_.b2Vec2.s_t0))}}}u.b2ConstantAccelController=C;var x={};Object.defineProperty(x,"__esModule",{value:!0}),x.b2ConstantForceController=void 0;const v=e,f=n;class S extends f.b2Controller{constructor(){super(...arguments),this.F=new v.b2Vec2}Step(e){for(let e=this.m_bodyList;e;e=e.nextBody){const{body:t}=e;t.IsAwake()&&t.ApplyForce(this.F,t.GetWorldCenter())}}}x.b2ConstantForceController=S;var L={};Object.defineProperty(L,"__esModule",{value:!0}),L.b2GravityController=void 0;const V=e,g=n,w=new V.b2Vec2;class B extends g.b2Controller{constructor(){super(...arguments),this.G=1,this.invSqr=!0}Step(e){if(this.invSqr)for(let e=this.m_bodyList;e;e=e.nextBody){const t=e.body,o=t.GetWorldCenter(),r=t.GetMass();for(let n=this.m_bodyList;n&&n!==e;n=n.nextBody){const e=n.body,l=e.GetWorldCenter(),s=e.GetMass(),i=l.x-o.x,c=l.y-o.y,a=i*i+c*c;a<V.b2_epsilon||(w.Set(i,c).Scale(this.G/a/Math.sqrt(a)*r*s),t.IsAwake()&&t.ApplyForce(w,o),e.IsAwake()&&e.ApplyForce(w.Scale(-1),l))}}else for(let e=this.m_bodyList;e;e=e.nextBody){const t=e.body,o=t.GetWorldCenter(),r=t.GetMass();for(let n=this.m_bodyList;n&&n!==e;n=n.nextBody){const e=n.body,l=e.GetWorldCenter(),s=e.GetMass(),i=l.x-o.x,c=l.y-o.y,a=i*i+c*c;a<V.b2_epsilon||(w.Set(i,c).Scale(this.G/a*r*s),t.IsAwake()&&t.ApplyForce(w,o),e.IsAwake()&&e.ApplyForce(w.Scale(-1),l))}}}}L.b2GravityController=B;var A={};Object.defineProperty(A,"__esModule",{value:!0}),A.b2TensorDampingController=void 0;const G=e,M=n,T=new G.b2Vec2;class D extends M.b2Controller{constructor(){super(...arguments),this.T=new G.b2Mat22,this.maxTimestep=0}Step(e){let t=e.dt;if(!(t<=G.b2_epsilon)){t>this.maxTimestep&&this.maxTimestep>0&&(t=this.maxTimestep);for(let e=this.m_bodyList;e;e=e.nextBody){const{body:o}=e;o.IsAwake()&&(o.GetWorldVector(G.b2Mat22.MultiplyVec2(this.T,o.GetLocalVector(o.GetLinearVelocity(),G.b2Vec2.s_t0),G.b2Vec2.s_t1),T),o.SetLinearVelocity(G.b2Vec2.Add(o.GetLinearVelocity(),G.b2Vec2.Scale(t,T,G.b2Vec2.s_t0),G.b2Vec2.s_t1)))}}}SetAxisAligned(e,t){this.T.ex.x=-e,this.T.ex.y=0,this.T.ey.x=0,this.T.ey.y=-t,this.maxTimestep=e>0||t>0?1/Math.max(e,t):0}}A.b2TensorDampingController=D;var F={};Object.defineProperty(F,"__esModule",{value:!0}),F.DrawControllers=void 0;const O=e,P=i,j={buoyancyController:new O.b2Color(0,0,.8)},W=new O.b2Vec2,I=new O.b2Vec2,k=100;var q,R,E;F.DrawControllers=function(e,t){for(let n=t.m_controllerList;n;n=n.m_next)n instanceof P.b2BuoyancyController&&(o=e,r=n,W.x=r.normal.x*r.offset+r.normal.y*k,W.y=r.normal.y*r.offset-r.normal.x*k,I.x=r.normal.x*r.offset-r.normal.y*k,I.y=r.normal.y*r.offset+r.normal.x*k,o.DrawSegment(W,I,j.buoyancyController));var o,r},q=o,R=t&&t.__createBinding||(Object.create?function(e,t,o,r){void 0===r&&(r=o);var n=Object.getOwnPropertyDescriptor(t,o);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[o]}}),Object.defineProperty(e,r,n)}:function(e,t,o,r){void 0===r&&(r=o),e[r]=t[o]}),E=t&&t.__exportStar||function(e,t){for(var o in e)"default"===o||Object.prototype.hasOwnProperty.call(t,o)||R(t,e,o)},Object.defineProperty(q,"__esModule",{value:!0}),E(n,q),E(i,q),E(u,q),E(x,q),E(L,q),E(A,q),E(F,q);var N=o.DrawControllers,Z=o.__esModule,z=o.b2BuoyancyController,H=o.b2ConstantAccelController,J=o.b2ConstantForceController,K=o.b2Controller,Q=o.b2ControllerEdge,U=o.b2GravityController,X=o.b2TensorDampingController;export{N as DrawControllers,Z as __esModule,z as b2BuoyancyController,H as b2ConstantAccelController,J as b2ConstantForceController,K as b2Controller,Q as b2ControllerEdge,U as b2GravityController,X as b2TensorDampingController,o as default};
//# sourceMappingURL=/sm/bef7fd5f2bafdc8ec1f16b146b6651c337f2fda7837a4c994e19239503e10e50.map