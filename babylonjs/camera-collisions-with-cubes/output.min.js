window.onload=function(){var canvas=document.getElementById("renderCanvas");var collisions=new COLLISIONS.Basics(canvas);collisions.createScene();var isLocked=false;var blocker=document.getElementById("blocker");var instructions=document.getElementById("instructions");var havePointerLock="pointerLockElement"in document||"mozPointerLockElement"in document||"webkitPointerLockElement"in document;if(havePointerLock){var element=canvas;var pointerlockchange=function(event){if(document.pointerLockElement===element||document.mozPointerLockElement===element||document.webkitPointerLockElement===element){blocker.style.display="none";isLocked=true}else{blocker.style.display="block";instructions.style.display="";isLocked=false}};var pointerlockerror=function(event){instructions.style.display=""};document.addEventListener("pointerlockchange",pointerlockchange,false);document.addEventListener("mozpointerlockchange",pointerlockchange,false);document.addEventListener("webkitpointerlockchange",pointerlockchange,false);document.addEventListener("pointerlockerror",pointerlockerror,false);document.addEventListener("mozpointerlockerror",pointerlockerror,false);document.addEventListener("webkitpointerlockerror",pointerlockerror,false);instructions.addEventListener("click",function(event){instructions.style.display="none";element.requestPointerLock=element.requestPointerLock||element.mozRequestPointerLock||element.webkitRequestPointerLock;element.requestPointerLock()},false)}else{instructions.innerHTML="Your browser doesn't seem to support Pointer Lock API"}};var COLLISIONS;(function(COLLISIONS){var Basics=function(){function Basics(canvas){this._engine=new BABYLON.Engine(canvas);this._engine.isPointerLock=true;this._scene=new BABYLON.Scene(this._engine);this._camera=new BABYLON.FreeCamera("camera",new BABYLON.Vector3(29,13,23),this._scene);this._camera.setTarget(new BABYLON.Vector3(0,0,0));this._camera.attachControl(canvas);this._camera.keysUp.push(87);this._camera.keysLeft.push(65);this._camera.keysDown.push(83);this._camera.keysRight.push(68);this._light=new BABYLON.PointLight("Omni",new BABYLON.Vector3(-80,40,-100),this._scene);this._light.intensity=1;var dirLight=new BABYLON.HemisphericLight("HemisphericLight",new BABYLON.Vector3(80,-40,100),this._scene);dirLight.specular=new BABYLON.Color3(0,0,0);dirLight.intensity=.5;window.addEventListener("resize",function(){if(this._engine!==undefined){this._engine.resize()}})}Basics.prototype.runRenderLoop=function(){var _this=this;this._engine.runRenderLoop(function(){_this._scene.render()})};Basics.prototype.stopRenderLoop=function(){this._engine.stopRenderLoop()};Basics.prototype.createCollisions=function(){this._scene.collisionsEnabled=true;this._camera.applyGravity=true;this._camera.checkCollisions=true;this._camera.ellipsoid=new BABYLON.Vector3(1,1.8,1);this._scene.gravity=new BABYLON.Vector3(0,-.03,0);this._plane.checkCollisions=true;this._box.checkCollisions=true;this._box2.checkCollisions=true;this._sphere.checkCollisions=true;for(var i=0;i<this._boxes.length;i++){this._boxes[i].checkCollisions=true}};Basics.prototype.createPhysics=function(){this._scene.enablePhysics(new BABYLON.Vector3(0,-9.81,0),new BABYLON.OimoJSPlugin);this._plane.setPhysicsState(BABYLON.PhysicsEngine.PlaneImpostor,{mass:0,friction:.5,restitution:.5});this._box.setPhysicsState(BABYLON.PhysicsEngine.BoxImpostor,{mass:1,friction:.5,restitution:.5});this._box2.setPhysicsState(BABYLON.PhysicsEngine.BoxImpostor,{mass:1,friction:.5,restitution:.5});this._sphere.setPhysicsState(BABYLON.PhysicsEngine.SphereImpostor,{mass:10,friction:.5,restitution:0});this._box2.applyImpulse(new BABYLON.Vector3(-18,0,0),new BABYLON.Vector3(this._box2.position.x,0,0));this._sphere.applyImpulse(new BABYLON.Vector3(0,-10,0),this._sphere.position);for(var i=0;i<this._boxes.length;i++){this._boxes[i].setPhysicsState(BABYLON.PhysicsEngine.BoxImpostor,{mass:1,friction:.5,restitution:.5})}};Basics.prototype.disablePhysics=function(){this._scene.disablePhysicsEngine()};Basics.prototype.createScene=function(){var _this=this;var scaleValue=20;var assetsManager=new BABYLON.AssetsManager(this._scene);assetsManager.onProgress=function(remainingCount,totalCount,lastFinishedTask){_this._engine.loadingUIText="We are loading the scene. "+remainingCount+" out of "+totalCount+" items still need to be loaded."};var planeMaterial=new BABYLON.StandardMaterial("plane_material",this._scene);var diffuseTextureTask=assetsManager.addTextureTask("image task","floor_diffuse.png");diffuseTextureTask.onSuccess=function(task){task.texture.vScale=task.texture.uScale=scaleValue;planeMaterial.diffuseTexture=task.texture};var bumpTextureTask=assetsManager.addTextureTask("image task","floor_bump.png");bumpTextureTask.onSuccess=function(task){task.texture.vScale=task.texture.uScale=scaleValue;planeMaterial.bumpTexture=task.texture};var specularTextureTask=assetsManager.addTextureTask("image task","floor_specular.png");specularTextureTask.onSuccess=function(task){task.texture.vScale=task.texture.uScale=scaleValue;planeMaterial.specularTexture=task.texture};var ambientTextureTask=assetsManager.addTextureTask("image task","floor_ao.png");ambientTextureTask.onSuccess=function(task){task.texture.vScale=task.texture.uScale=scaleValue;planeMaterial.ambientTexture=task.texture};var boxMaterial=new BABYLON.StandardMaterial("box_material",this._scene);var boxTextureTask=assetsManager.addTextureTask("image task","wood.jpg");boxTextureTask.onSuccess=function(task){boxMaterial.diffuseTexture=task.texture};var sphereMaterial=new BABYLON.StandardMaterial("sphere_material",this._scene);var sphereTextureTask=assetsManager.addTextureTask("image task","sphere.jpg");sphereTextureTask.onSuccess=function(task){sphereMaterial.diffuseTexture=task.texture};var skybox=this._createSkybox();assetsManager.onFinish=function(tasks){_this._plane=BABYLON.Mesh.CreateGround("ground",400,400,2,_this._scene);_this._plane.material=planeMaterial;_this._box=BABYLON.Mesh.CreateBox("box",5,_this._scene);_this._box.refreshBoundingInfo();_this._box.position.y=2.5;_this._box.material=boxMaterial;_this._box2=_this._box.clone("box2");_this._box2.position.x=20;_this._sphere=BABYLON.Mesh.CreateSphere("sphere",6,3,_this._scene);_this._sphere.position.x=3;_this._sphere.position.y=18;_this._sphere.material=sphereMaterial;function shuffle(array){var currentIndex=array.length,temporaryValue,randomIndex;while(0!==currentIndex){randomIndex=Math.floor(Math.random()*currentIndex);currentIndex-=1;temporaryValue=array[currentIndex];array[currentIndex]=array[randomIndex];array[randomIndex]=temporaryValue}return array}var points=[];for(var x=-100;x<100;x+=5){for(var z=-100;z<100;z+=5){points.push({x:x,z:z})}}points=shuffle(points);_this._boxes=[];for(var i=0;i<100;i++){var box=_this._box.clone("box");box.position.x=points[i].x;box.position.z=points[i].z;_this._boxes.push(box)}_this.createCollisions();_this.createPhysics();_this.runRenderLoop()};assetsManager.load()};Basics.prototype._createSkybox=function(){var material=new BABYLON.StandardMaterial("skyboxMaterial",this._scene);material.reflectionTexture=new BABYLON.CubeTexture("skybox/TropicalSunnyDay",this._scene);material.reflectionTexture.coordinatesMode=BABYLON.Texture.SKYBOX_MODE;material.backFaceCulling=false;material.fogEnabled=false;var skybox=BABYLON.Mesh.CreateBox("skybox",300,this._scene);skybox.material=material;return skybox};return Basics}();COLLISIONS.Basics=Basics})(COLLISIONS||(COLLISIONS={}));